# エラーメッセージの改善例

このドキュメントでは、実装したエラーフォーマッターによって、ユーザーに表示されるエラーメッセージがどのように改善されたかを示します。

## 予約機能のエラー

### ケース1: 予約枠の重複（409 Conflict）

#### 従来
```
タイトル: エラーが発生しました
メッセージ: (409) 予約の作成に失敗しました。
```

#### 改善後
```
タイトル: データの競合が発生しました
メッセージ: この時間帯は既に予約されています。
アクション: 別の時間帯を選択してください。
```

**改善点**:
- ステータスコードが非表示になり、ユーザーフレンドリーなタイトルに
- 具体的な問題（時間帯の重複）を明示
- 次に取るべき行動（別の時間帯を選択）を提示

---

### ケース2: 入力データの不備（400 Bad Request）

#### 従来
```
タイトル: エラーが発生しました
メッセージ: (400) 予約の作成に失敗しました。
```

#### 改善後
```
タイトル: 入力内容に問題があります
メッセージ: 予約情報に不備があります。
アクション: 日時、バンド名などの入力内容を確認してください。
```

**改善点**:
- 問題の種類（入力内容の不備）を明確化
- 確認すべき項目（日時、バンド名）を具体的に提示

---

### ケース3: 予約の認証失敗（401 Unauthorized）

#### 従来
```
タイトル: エラーが発生しました
メッセージ: (401) 予約の認証に失敗しました。
```

#### 改善後
```
タイトル: 認証が必要です
メッセージ: パスワードが正しくありません。
アクション: 正しいパスワードを入力してください。
```

**改善点**:
- パスワードの問題であることを明示
- 再入力を促す具体的なアクション

---

## バンド機能のエラー

### ケース4: バンド名の重複（409 Conflict）

#### 従来
```
タイトル: エラーが発生しました
メッセージ: (409) バンドの作成に失敗しました。
```

#### 改善後
```
タイトル: データの競合が発生しました
メッセージ: 同じ名前のバンドが既に存在します。
アクション: 別の名前を使用してください。
```

**改善点**:
- 重複の原因（同じバンド名）を明示
- 解決方法（別の名前を使用）を提示

---

### ケース5: バンドが見つからない（404 Not Found）

#### 従来
```
タイトル: エラーが発生しました
メッセージ: (404) バンド情報の取得に失敗しました。
```

#### 改善後
```
タイトル: データが見つかりません
メッセージ: 指定されたデータが見つかりませんでした。
アクション: URLやIDが正しいか確認してください。削除された可能性もあります。
```

**改善点**:
- データが存在しないことを明確化
- 確認すべきポイント（URL、ID）を提示
- 削除の可能性も示唆

---

## ユーザー認証のエラー

### ケース6: 未認証（401 Unauthorized）

#### 従来
```
タイトル: エラーが発生しました
メッセージ: (401) Not authenticated
```

#### 改善後
```
タイトル: 認証が必要です
メッセージ: この操作を行うにはログインが必要です。
アクション: ログインしてから再度お試しください。
```

**改善点**:
- 英語メッセージを日本語化
- ログインが必要であることを明示
- ログイン後の再試行を促す

---

### ケース7: アクセス権限なし（403 Forbidden）

#### 従来
```
タイトル: エラーが発生しました
メッセージ: (403) Access denied
```

#### 改善後
```
タイトル: アクセスが拒否されました
メッセージ: この操作を行う権限がありません。
アクション: 必要な権限があるか確認してください。問題が続く場合は管理者にお問い合わせください。
```

**改善点**:
- 英語メッセージを日本語化
- 権限の問題であることを明示
- 確認手順と問題が続く場合の対処法を提示

---

## ファイルアップロードのエラー

### ケース8: ファイル形式エラー（400 Bad Request）

#### 従来
```
タイトル: エラーが発生しました
メッセージ: (400) Invalid file format
```

#### 改善後
```
タイトル: 入力内容に問題があります
メッセージ: ファイル形式またはサイズに問題があります。
アクション: 対応している形式とサイズ制限を確認してください。
```

**改善点**:
- ファイルの問題であることを明示
- 形式とサイズの両方をチェックするよう促す

---

## サーバーエラー

### ケース9: 内部サーバーエラー（500 Internal Server Error）

#### 従来
```
タイトル: エラーが発生しました
メッセージ: (500) サーバーエラーが発生しました。
```

#### 改善後
```
タイトル: サーバーエラーが発生しました
メッセージ: サーバー側で問題が発生しています。
アクション: 時間をおいて再度お試しください。問題が続く場合は管理者にお問い合わせください。
```

**改善点**:
- サーバー側の問題であることを明確化
- ユーザーができる対処法（時間をおいて再試行）を提示
- 問題が続く場合の対処法も提示

---

### ケース10: サービス一時停止（503 Service Unavailable）

#### 従来
```
タイトル: エラーが発生しました
メッセージ: (503) Service Unavailable
```

#### 改善後
```
タイトル: サーバーエラーが発生しました
メッセージ: サーバー側で問題が発生しています。
アクション: 時間をおいて再度お試しください。問題が続く場合は管理者にお問い合わせください。
```

**改善点**:
- 英語メッセージを日本語化
- メンテナンスや一時的な問題の可能性を示唆
- 待機と再試行を促す

---

## レート制限

### ケース11: リクエスト過多（429 Too Many Requests）

#### 従来
```
タイトル: エラーが発生しました
メッセージ: (429) Rate limit exceeded
```

#### 改善後
```
タイトル: リクエスト制限に達しました
メッセージ: 短時間に多くのリクエストが送信されました。
アクション: しばらく時間をおいてから再度お試しください。
```

**改善点**:
- 制限の理由（短時間の多数リクエスト）を説明
- 待機時間が必要であることを明示

---

## バリデーションエラー

### ケース12: 複数フィールドのエラー（400 Bad Request）

#### 従来
```
タイトル: エラーが発生しました
メッセージ: (400) 予約の作成に失敗しました。
```

#### 改善後
```
タイトル: 入力内容に問題があります
メッセージ: 入力された情報に誤りがあります。
アクション: 入力内容を確認して、もう一度お試しください。
詳細: name: Name is required, email: Invalid email format
```

**改善点**:
- 各フィールドのエラーを詳細セクションに表示
- どのフィールドに問題があるかを明確化

---

## まとめ

### 改善の共通パターン

1. **ユーザーフレンドリーなタイトル**
   - ステータスコードを隠し、問題の種類を示すタイトルに

2. **具体的な説明**
   - 何が問題なのかを明確に説明

3. **アクション指向**
   - ユーザーが次に何をすべきかを明示

4. **日本語化**
   - 英語のエラーメッセージを日本語に翻訳

5. **コンテキスト認識**
   - エラーの状況に応じて最適なメッセージを自動選択

### ユーザーへの影響

- **混乱の軽減**: 技術的な用語やコードではなく、分かりやすい言葉で説明
- **自己解決の促進**: 次のアクションを明示することで、ユーザー自身で問題を解決しやすく
- **サポート負荷の軽減**: より明確なエラーメッセージにより、サポートへの問い合わせが減少
- **ユーザー体験の向上**: エラー時でもフレンドリーで役立つメッセージを提供
